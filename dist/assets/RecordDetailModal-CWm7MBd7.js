import{r as m,j as e,U as ie,C as ce,R as $,S as C,a as de,P as J,M as oe,L as xe,b as me,c as he,d as ge,e as V,f as ue,A as je,D as be,g as pe,h as Ne,i as fe,T as Y,k as ye,E as ve,l as we}from"./index-DWy39khm.js";const u=({title:s,children:j,defaultOpen:b=!1})=>{const[h,p]=m.useState(b);return e.jsxs("div",{className:"border-t",children:[e.jsxs("button",{onClick:()=>p(!h),className:"w-full flex justify-between items-center py-4 text-left",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:s}),e.jsx(we,{className:`h-5 w-5 text-gray-500 transition-transform ${h?"rotate-180":""}`})]}),h&&e.jsx("div",{className:"pb-4 space-y-4",children:j})]})},q=window.SpeechRecognition||window.webkitSpeechRecognition,Ce=s=>{if(!s)return null;const j=s.match(/(昭和|平成|令和)(\d{1,2}|元)年(\d{1,2})月(\d{1,2})日/);if(!j)return null;const[,b,h,p,E]=j,f=h==="元"?1:parseInt(h,10),g=parseInt(p,10),y=parseInt(E,10);let N;switch(b){case"昭和":N=1925+f;break;case"平成":N=1988+f;break;case"令和":N=2018+f;break;default:return null}return{year:N,month:g,day:y}},Se=({person:s,activities:j,districts:b,isOpen:h,onClose:p,onSave:E,onDelete:f,isCreatingNew:g,calculateAge:y,onAddActivity:N,onDeleteActivity:z,onOpenAIAssistant:B,onOpenAIUpdate:K,aiProvider:O,isGoogleSignedIn:Q,onAddToCalendar:X})=>{var _,G;const[M,I]=m.useState(g),[l,F]=m.useState(s),[H,D]=m.useState(""),[P,S]=m.useState(!1),R=m.useRef(null),[A,v]=m.useState("idle"),[W,U]=m.useState(!1),L=y(l.dob),Z=((_=b.find(a=>a.id===l.districtId))==null?void 0:_.name)||"（自動割り当て）",w=j.sort((a,t)=>new Date(t.date).getTime()-new Date(a.date).getTime());if(m.useEffect(()=>{F({...s,age:y(s.dob)}),I(g),v("idle"),U(!1)},[s,g,y]),!h)return null;const r=a=>{const{name:t,value:n}=a.target,o=["ledgerId"].includes(t);F(x=>({...x,[t]:o?n?Number(n):null:n}))},ee=()=>{E({...l,age:L}),I(!1)},se=()=>{N(H),D("")},ae=()=>{var t;if(!q){alert("お使いのブラウザは音声入力に対応していません。");return}if(P){(t=R.current)==null||t.stop(),S(!1);return}R.current=new q;const a=R.current;a.lang="ja-JP",a.interimResults=!0,a.continuous=!0,a.onstart=()=>{S(!0)},a.onend=()=>{S(!1)},a.onerror=n=>{console.error("Speech recognition error",n.error),S(!1)},a.onresult=n=>{let o="",x="";for(let d=n.resultIndex;d<n.results.length;++d)n.results[d].isFinal?x+=n.results[d][0].transcript:o+=n.results[d][0].transcript;D(d=>d+x)},a.start()},te=async()=>{v("adding"),await X(s)?v("success"):(v("error"),alert("Googleカレンダーへの登録に失敗しました。設定を確認してください。"),setTimeout(()=>v("idle"),3e3))},le=()=>{if(w.length===0)return;const a=`【${s.name}様 活動記録】

`+w.map(t=>{const n=new Date(t.date);return`- ${`${n.getFullYear()}/${(n.getMonth()+1).toString().padStart(2,"0")}/${n.getDate().toString().padStart(2,"0")} ${n.getHours().toString().padStart(2,"0")}:${n.getMinutes().toString().padStart(2,"0")}`}
  ${t.content.replace(/\n/g,`
  `)}`}).join(`

`);navigator.clipboard.writeText(a).then(()=>{U(!0),setTimeout(()=>U(!1),2e3)}).catch(t=>{console.error("Failed to copy text: ",t),alert("コピーに失敗しました。")})},ne=a=>{if(!a)return"ー";const t=Ce(a);return t?`${a} (${t.year}年)`:a},c=({label:a,value:t})=>e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-500",children:a}),e.jsx("p",{className:"text-gray-800",children:t||"ー"})]}),k=({href:a,icon:t,text:n,label:o,target:x,rel:d})=>e.jsxs("a",{href:a,"aria-label":o,className:"flex items-center gap-2 text-brand-blue hover:underline",target:x,rel:d,children:[t,e.jsx("span",{children:n})]}),i=({label:a,name:t,value:n,onChange:o,type:x="text",children:d,readOnly:T=!1,rows:re=void 0})=>e.jsxs("div",{children:[e.jsx("label",{htmlFor:t.toString(),className:"block text-sm font-semibold text-gray-500 mb-1",children:a}),d||(x==="textarea"?e.jsx("textarea",{id:t.toString(),name:t.toString(),value:n||"",onChange:o,readOnly:T,rows:re,className:`w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-blue ${T?"bg-gray-100":"bg-white text-gray-900"}`}):e.jsx("input",{type:x,id:t.toString(),name:t.toString(),value:n||"",onChange:o,readOnly:T,className:`w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-blue ${T?"bg-gray-100":"bg-white text-gray-900"}`}))]});return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col",children:[e.jsxs("header",{className:"flex justify-between items-center p-4 border-b",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ie,{className:"h-8 w-8 text-brand-blue mr-3"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:g?"新規レコード作成":s.name})]}),e.jsx("button",{onClick:p,className:"text-gray-500 hover:text-gray-800",children:e.jsx(ce,{className:"h-6 w-6"})})]}),e.jsx("main",{className:"p-6 overflow-y-auto",children:M?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(i,{label:"氏名",name:"name",value:l.name,onChange:r}),e.jsx(i,{label:"ふりがな",name:"furigana",value:l.furigana,onChange:r})]}),e.jsx(u,{title:"基本情報",defaultOpen:!0,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(i,{label:"所属地区 (住所から自動割当)",name:"districtId",value:Z,readOnly:!0}),e.jsx(i,{label:"台帳番号",name:"ledgerId",type:"number",value:l.ledgerId,onChange:r}),e.jsx(i,{label:"生年月日",name:"dob",value:l.dob,onChange:r}),e.jsx(i,{label:"年齢 (自動計算)",name:"age",type:"number",value:L!==null?`${L}歳`:"ー",readOnly:!0}),e.jsx(i,{label:"性別",name:"gender",value:l.gender,onChange:r,children:e.jsxs("select",{id:"gender",name:"gender",value:l.gender,onChange:r,className:"w-full p-2 border border-gray-300 rounded-md bg-white text-gray-900",children:[e.jsx("option",{value:"女",children:"女"}),e.jsx("option",{value:"男",children:"男"})]})}),e.jsx(i,{label:"世帯区分",name:"householdType",value:l.householdType,onChange:r}),e.jsx(i,{label:"住居属性",name:"residenceType",value:l.residenceType,onChange:r,children:e.jsxs("select",{id:"residenceType",name:"residenceType",value:l.residenceType||"",onChange:r,className:"w-full p-2 border border-gray-300 rounded-md bg-white text-gray-900",children:[e.jsx("option",{value:$.NONE,children:"-"}),e.jsx("option",{value:$.OWNED,children:"持家"}),e.jsx("option",{value:$.RENTED,children:"貸家"}),e.jsx("option",{value:$.APARTMENT,children:"アパート"})]})}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(i,{label:"ステータス",name:"status",value:l.status,onChange:r,children:e.jsxs("select",{id:"status",name:"status",value:l.status,onChange:r,className:"w-full p-2 border border-gray-300 rounded-md bg-white text-gray-900",children:[e.jsx("option",{value:C.NONE,children:"-"}),e.jsx("option",{value:C.CONTINUE,children:"継続"}),e.jsx("option",{value:C.NEEDS_REVIEW,children:"要検討"}),e.jsx("option",{value:C.IN_HOSPITAL,children:"入院中"}),e.jsx("option",{value:C.DISCONTINUED,children:"廃止"})]})})})]})}),e.jsxs(u,{title:"連絡先情報",children:[e.jsx(i,{label:"住所",name:"address",value:l.address,onChange:r}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4",children:[e.jsx(i,{label:"電話番号",name:"phone",type:"tel",value:l.phone,onChange:r}),e.jsx(i,{label:"メールアドレス",name:"email",type:"email",value:l.email,onChange:r}),e.jsx(i,{label:"LINE ID",name:"lineId",value:l.lineId,onChange:r})]})]}),e.jsx(u,{title:"緊急連絡先情報",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"md:col-span-1",children:e.jsx(i,{label:"氏名",name:"emergencyContactName",value:l.emergencyContactName,onChange:r})}),e.jsx("div",{className:"md:col-span-1",children:e.jsx(i,{label:"続柄",name:"emergencyContactRelationship",value:l.emergencyContactRelationship,onChange:r})}),e.jsx("div",{className:"md:col-span-1",children:e.jsx(i,{label:"電話番号",name:"emergencyContactPhone",type:"tel",value:l.emergencyContactPhone,onChange:r})})]})}),e.jsx(u,{title:"次回訪問予定",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(i,{label:"訪問予定日",name:"followUpDate",type:"date",value:l.followUpDate,onChange:r}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(i,{label:"予定内容",name:"followUpNote",type:"textarea",value:l.followUpNote,onChange:r,rows:2})})]})}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"活動履歴"}),e.jsx("p",{className:"text-sm text-gray-500",children:"編集中は活動履歴の追加・削除はできません。"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:s.furigana}),e.jsx("h3",{className:"text-xl font-bold text-gray-800 -mt-1",children:s.name})]}),e.jsx(de,{status:s.status})]}),e.jsx(u,{title:"基本情報",defaultOpen:!0,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsx(c,{label:"所属地区",value:(G=b.find(a=>a.id===s.districtId))==null?void 0:G.name}),e.jsx(c,{label:"台帳番号",value:s.ledgerId}),e.jsx(c,{label:"年齢",value:s.age!==null?`${s.age}歳`:"ー"}),e.jsx(c,{label:"性別",value:s.gender}),e.jsx(c,{label:"生年月日",value:ne(s.dob)}),e.jsx(c,{label:"世帯区分",value:s.householdType}),e.jsx(c,{label:"住居属性",value:s.residenceType})]})}),e.jsxs(u,{title:"連絡先情報",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[s.phone?e.jsx(k,{href:`tel:${s.phone}`,icon:e.jsx(J,{className:"h-5 w-5"}),text:s.phone,label:`電話をかける: ${s.phone}`}):e.jsx(c,{label:"電話番号",value:null}),s.email?e.jsx(k,{href:`mailto:${s.email}`,icon:e.jsx(oe,{className:"h-5 w-5"}),text:s.email,label:`メールを送る: ${s.email}`}):e.jsx(c,{label:"メールアドレス",value:null}),s.lineId?e.jsx(k,{href:`https://line.me/ti/p/~${s.lineId}`,icon:e.jsx(xe,{className:"h-5 w-5"}),text:s.lineId,label:`LINEで連絡: ${s.lineId}`,target:"_blank",rel:"noopener noreferrer"}):e.jsx(c,{label:"LINE ID",value:null})]}),e.jsxs("div",{className:"pt-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-500",children:"住所"}),s.address?e.jsxs("a",{href:`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(s.address)}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-brand-blue hover:underline","aria-label":`Googleマップで住所を開く: ${s.address}`,children:[e.jsx(me,{className:"h-5 w-5 flex-shrink-0"}),e.jsx("p",{className:"text-gray-800",children:s.address})]}):e.jsx("p",{className:"text-gray-800",children:"ー"})]})]}),e.jsx(u,{title:"緊急連絡先情報",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsx(c,{label:"氏名",value:s.emergencyContactName}),e.jsx(c,{label:"続柄",value:s.emergencyContactRelationship}),s.emergencyContactPhone?e.jsx(k,{href:`tel:${s.emergencyContactPhone}`,icon:e.jsx(J,{className:"h-5 w-5"}),text:s.emergencyContactPhone,label:`緊急連絡先に電話をかける: ${s.emergencyContactPhone}`}):e.jsx(c,{label:"電話番号",value:null})]})}),e.jsx(u,{title:"次回訪問予定",children:s.followUpDate?e.jsxs("div",{className:"flex items-start gap-4 bg-yellow-50 p-3 rounded-md",children:[e.jsx(he,{className:"h-5 w-5 text-yellow-600 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-semibold text-yellow-800",children:s.followUpDate}),Q&&A!=="success"&&e.jsxs("button",{onClick:te,disabled:A==="adding",className:"flex items-center gap-1.5 px-2 py-1 text-xs bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50",children:[e.jsx(ge,{className:"h-4 w-4"}),e.jsx("span",{children:"Googleカレンダーに追加"})]})," ",A==="success"&&e.jsxs("span",{className:"flex items-center gap-1.5 text-xs text-green-600",children:[e.jsx(V,{className:"h-4 w-4"}),"登録しました"]})]}),e.jsx("p",{className:"text-yellow-700 whitespace-pre-wrap mt-1",children:s.followUpNote})]})]}):e.jsx("p",{className:"text-gray-500 text-sm",children:"訪問予定はありません。"})}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"活動履歴"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:le,className:"flex items-center gap-2 px-3 py-1.5 text-sm bg-blue-100 text-brand-blue rounded-md hover:bg-blue-200 transition-colors disabled:opacity-50",disabled:w.length===0,children:[W?e.jsx(V,{className:"h-4 w-4 text-green-600"}):e.jsx(ue,{className:"h-4 w-4"}),e.jsx("span",{children:W?"コピーしました":"履歴をコピー"})]}),O&&O!==je.NONE&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>K(s),className:"flex items-center gap-2 px-3 py-1.5 text-sm bg-green-100 text-theme-green-dark rounded-md hover:bg-green-200 transition-colors",children:[e.jsx(be,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"AIで更新"})]}),e.jsxs("button",{onClick:()=>B(s),className:"flex items-center gap-2 px-3 py-1.5 text-sm bg-purple-100 text-theme-purple-dark rounded-md hover:bg-purple-200 transition-colors",children:[e.jsx(pe,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"AIアシスタント"})]})]})]})]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{value:H,onChange:a=>D(a.target.value),placeholder:"新しい活動内容を入力...",rows:3,className:"w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-blue pr-10"}),e.jsx("button",{onClick:ae,className:`absolute right-2 top-2 p-1 rounded-full ${P?"bg-red-500 text-white animate-pulse":"bg-gray-200 text-gray-600 hover:bg-gray-300"}`,title:P?"録音停止":"音声入力開始",children:e.jsx(Ne,{className:"h-5 w-5"})})]}),e.jsxs("button",{onClick:se,className:"mt-2 flex items-center px-3 py-1.5 bg-brand-blue text-white rounded-md text-sm hover:bg-blue-800",children:[e.jsx(fe,{className:"h-4 w-4 mr-1"}),"履歴を追加"]})]}),e.jsx("div",{className:"space-y-3 max-h-48 overflow-y-auto pr-2",children:w.length>0?w.map(a=>e.jsxs("div",{className:"bg-gray-50 p-3 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("p",{className:"text-xs text-gray-500",children:new Date(a.date).toLocaleString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}),e.jsx("button",{onClick:()=>z(a.id),className:"text-gray-400 hover:text-red-500",children:e.jsx(Y,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-gray-800 whitespace-pre-wrap mt-1",children:a.content})]},a.id)):e.jsx("p",{className:"text-gray-500 text-sm",children:"活動履歴はありません。"})})]})]})]})}),e.jsxs("footer",{className:"flex justify-between items-center p-4 border-t bg-gray-50 rounded-b-lg",children:[e.jsx("div",{children:!g&&e.jsxs("button",{onClick:()=>f(s.id),className:"flex items-center px-4 py-2 text-red-600 hover:bg-red-100 rounded-md transition-colors",children:[e.jsx(Y,{className:"h-5 w-5 mr-2"}),"削除"]})}),e.jsx("div",{className:"flex gap-2",children:M?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>g?p():I(!1),className:"px-4 py-2 text-gray-700 bg-gray-200 hover:bg-gray-300 rounded-md transition-colors",children:"キャンセル"}),e.jsxs("button",{onClick:ee,className:"flex items-center px-4 py-2 bg-brand-blue text-white rounded-md hover:bg-blue-800 transition-colors",children:[e.jsx(ye,{className:"h-5 w-5 mr-2"}),"保存"]})]}):e.jsxs("button",{onClick:()=>I(!0),className:"flex items-center px-4 py-2 bg-gray-700 text-white rounded-md hover:bg-gray-800 transition-colors",children:[e.jsx(ve,{className:"h-5 w-5 mr-2"}),"編集"]})})]})]})})};export{Se as default};
