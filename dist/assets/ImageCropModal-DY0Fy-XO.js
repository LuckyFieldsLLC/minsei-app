import{r as y,j as g,C as E,k as D}from"./index-DWy39khm.js";const L=({imageSrc:M,onCropComplete:S,onClose:C})=>{const p=y.useRef(null),w=y.useRef(new Image),[i,W]=y.useState({x:0,y:0,width:100,height:100}),[m,H]=y.useState(null);y.useEffect(()=>{const n=w.current;n.src=M,n.onload=()=>{const t=p.current;if(!t||!t.getContext("2d"))return;const{naturalWidth:s,naturalHeight:a}=n,d=t.offsetWidth,o=t.offsetHeight,e=Math.min(d/s,o/a),x=Math.min(s,a,200/e);W({x:(s-x)/2,y:(a-x)/2,width:x,height:x})}},[M]),y.useEffect(()=>{const n=p.current;if(!n)return;const t=n.getContext("2d");if(!t)return;const r=w.current;if(!r.complete)return;const{naturalWidth:s,naturalHeight:a}=r,d=n.offsetWidth,o=n.offsetHeight,e=Math.min(d/s,o/a);n.width=d,n.height=o;const x=s*e,b=a*e,l=(d-x)/2,h=(o-b)/2;t.clearRect(0,0,d,o),t.drawImage(r,l,h,x,b),t.fillStyle="rgba(0, 0, 0, 0.5)",t.fillRect(0,0,d,o);const f=i.x*e+l,u=i.y*e+h,c=i.width*e,v=i.height*e;t.save(),t.beginPath(),t.rect(f,u,c,v),t.clip(),t.drawImage(r,l,h,x,b),t.restore(),t.strokeStyle="white",t.lineWidth=2,t.strokeRect(f,u,c,v);const j=8;t.fillStyle="white",[{x:f,y:u},{x:f+c,y:u},{x:f,y:u+v},{x:f+c,y:u+v}].forEach(R=>t.fillRect(R.x-j/2,R.y-j/2,j,j))},[i,M]);const k=n=>{const t=p.current;if(!t)return null;const r=t.getBoundingClientRect(),s=n.clientX-r.left,a=n.clientY-r.top,{naturalWidth:d,naturalHeight:o}=w.current,e=Math.min(t.offsetWidth/d,t.offsetHeight/o),x=(t.offsetWidth-d*e)/2,b=(t.offsetHeight-o*e)/2,l=i.x*e+x,h=i.y*e+b,f=i.width*e,u=i.height*e,c=16;return s>l-c&&s<l+c&&a>h-c&&a<h+c?"tl":s>l+f-c&&s<l+f+c&&a>h-c&&a<h+c?"tr":s>l-c&&s<l+c&&a>h+u-c&&a<h+u+c?"bl":s>l+f-c&&s<l+f+c&&a>h+u-c&&a<h+u+c?"br":s>l&&s<l+f&&a>h&&a<h+u?"move":null},I=n=>{const t=k(n);t&&H({x:n.clientX,y:n.clientY,type:t,initialCrop:i})},X=n=>{if(!m)return;const t=n.clientX-m.x,r=n.clientY-m.y,s=p.current;if(!s)return;const{naturalWidth:a,naturalHeight:d}=w.current,o=Math.min(s.offsetWidth/a,s.offsetHeight/d);let e={...m.initialCrop};m.type==="move"?(e.x+=t/o,e.y+=r/o):(m.type.includes("l")&&(e.x+=t/o,e.width-=t/o),m.type.includes("r")&&(e.width+=t/o),m.type.includes("t")&&(e.y+=r/o,e.height-=r/o),m.type.includes("b")&&(e.height+=r/o)),e.x=Math.max(0,e.x),e.y=Math.max(0,e.y),e.width=Math.min(a-e.x,e.width),e.height=Math.min(d-e.y,e.height),W(e)},N=()=>{H(null)},Y=()=>{const n=w.current,t=document.createElement("canvas");t.width=i.width,t.height=i.height;const r=t.getContext("2d");r&&(r.drawImage(n,i.x,i.y,i.width,i.height,0,0,i.width,i.height),S(t.toDataURL("image/jpeg")))};return g.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 z-[60] flex justify-center items-center p-4",children:g.jsxs("div",{className:"bg-white rounded-lg shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col",children:[g.jsxs("header",{className:"flex justify-between items-center p-4 border-b",children:[g.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"写真を切り抜き"}),g.jsx("button",{onClick:C,className:"text-gray-500 hover:text-gray-800",children:g.jsx(E,{className:"h-6 w-6"})})]}),g.jsx("main",{className:"p-6 flex-grow flex justify-center items-center bg-gray-200",children:g.jsx("canvas",{ref:p,className:"max-w-full max-h-full cursor-grab",onMouseDown:I,onMouseMove:X,onMouseUp:N,onMouseLeave:N})}),g.jsxs("footer",{className:"flex justify-end items-center p-4 border-t bg-gray-50 rounded-b-lg gap-2",children:[g.jsx("button",{onClick:C,className:"px-4 py-2 text-gray-700 bg-gray-200 hover:bg-gray-300 rounded-md",children:"キャンセル"}),g.jsxs("button",{onClick:Y,className:"flex items-center px-4 py-2 bg-brand-blue text-white rounded-md hover:bg-blue-800",children:[g.jsx(D,{className:"h-5 w-5 mr-2"}),"切り抜いて保存"]})]})]})})};export{L as default};
