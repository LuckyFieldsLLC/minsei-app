import{r as o,j as e,C as _,m as A,S as U}from"./index-DWy39khm.js";const f=[{key:"ledgerId",label:"台帳番号"},{key:"name",label:"氏名"},{key:"furigana",label:"ふりがな"},{key:"dob",label:"生年月日"},{key:"age",label:"年齢"},{key:"gender",label:"性別"},{key:"householdType",label:"世帯区分"},{key:"address",label:"住所"},{key:"residenceType",label:"住居属性"},{key:"phone",label:"電話番号"},{key:"email",label:"メールアドレス"},{key:"lineId",label:"LINE ID"},{key:"emergencyContactName",label:"緊急連絡先氏名"},{key:"emergencyContactRelationship",label:"緊急連絡先続柄"},{key:"emergencyContactPhone",label:"緊急連絡先電話番号"},{key:"cooperator",label:"協力者"},{key:"memo",label:"最新調査メモ"},{key:"status",label:"ステータス"},{key:"check",label:"チェック"}],z=({isOpen:I,onClose:S,onImport:D})=>{const[y,j]=o.useState(null),[n,N]=o.useState([]),[h,k]=o.useState([]),[g,u]=o.useState({}),[d,v]=o.useState(!0),[w,b]=o.useState(""),[F,x]=o.useState(!1),E=()=>{j(null),N([]),k([]),u({}),v(!0),b(""),x(!1)},p=()=>{E(),S()},C=a=>{if(a){if(a.type!=="text/csv"&&!a.name.endsWith(".csv")){b("CSVファイルを選択してください。");return}j(a),b(""),x(!0),Papa.parse(a,{encoding:"UTF-8",complete:t=>{const s=t.data.filter(l=>l.some(i=>i.trim()!==""));if(s.length>0){const l=s[0];k(l.map((c,m)=>`列 ${m+1}`)),N(s);const i={};d&&l.forEach((c,m)=>{const r=f.find(V=>V.label===c.trim());i[m]=r?r.key:"none"}),u(i)}else b("ファイルが空か、解析できませんでした。");x(!1)},error:t=>{b(`解析エラー: ${t.message}`),x(!1)}})}},L=a=>{a.target.files&&a.target.files[0]&&C(a.target.files[0])},M=o.useCallback(a=>{a.preventDefault(),a.stopPropagation(),a.dataTransfer.files&&a.dataTransfer.files[0]&&C(a.dataTransfer.files[0])},[]),O=a=>{a.preventDefault(),a.stopPropagation()},P=(a,t)=>{u(s=>({...s,[a]:t}))},R=()=>{const t=(d?n.slice(1):n).map(s=>{const l={status:U.NONE};return Object.entries(g).forEach(([i,c])=>{const m=parseInt(i,10);if(c!=="none"&&s[m]!==void 0){let r=s[m];(c==="age"||c==="ledgerId")&&(r=r?parseInt(r,10):null,isNaN(r)&&(r=null)),l[c]=r}}),l}).filter(s=>s.name&&s.name.trim()!=="");D(t),p()};if(!I)return null;const T=d?n.slice(1,6):n.slice(0,5);return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[e.jsxs("header",{className:"flex justify-between items-center p-4 border-b",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"CSVデータインポート"}),e.jsx("button",{onClick:p,className:"text-gray-500 hover:text-gray-800",children:e.jsx(_,{className:"h-6 w-6"})})]}),e.jsx("main",{className:"p-6 overflow-y-auto",children:y?e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg mb-2",children:"1. カラムのマッピング"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"CSVファイルの各列を、アプリのどの項目に対応させるか選択してください。"}),e.jsx("div",{className:"mb-4",children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:d,onChange:a=>v(a.target.checked),className:"h-4 w-4 text-brand-blue focus:ring-brand-blue border-gray-300 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"最初の行をヘッダーとして無視する"})]})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-6",children:h.map((a,t)=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-1 bg-gray-100 p-2 rounded-t-md truncate",title:d&&n[0][t]?n[0][t]:a,children:d&&n[0][t]?n[0][t]:a}),e.jsxs("select",{value:g[t]||"none",onChange:s=>P(t,s.target.value),className:"w-full p-2 border border-gray-300 rounded-b-md focus:outline-none focus:ring-2 focus:ring-brand-blue bg-white text-gray-900",children:[e.jsx("option",{value:"none",children:"-- 割り当てない --"}),f.map(s=>e.jsx("option",{value:s.key,children:s.label},s.key))]})]},t))}),e.jsx("h3",{className:"font-bold text-lg mb-2",children:"2. プレビュー (最初の5行)"}),e.jsx("div",{className:"overflow-x-auto border rounded-lg",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsx("tr",{children:h.map((a,t)=>{const s=f.find(l=>l.key===g[t]);return e.jsx("th",{className:"p-2 font-semibold text-left text-gray-600",children:s?s.label:"（未割当）"},t)})})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:T.map((a,t)=>e.jsx("tr",{children:h.map((s,l)=>e.jsx("td",{className:"p-2 text-gray-700 truncate max-w-xs",children:a[l]||""},l))},t))})]})})]}):e.jsxs("div",{onDrop:M,onDragOver:O,className:"border-2 border-dashed border-gray-300 rounded-lg p-10 text-center",children:[e.jsx("input",{type:"file",id:"file-upload",className:"hidden",accept:".csv",onChange:L}),e.jsxs("label",{htmlFor:"file-upload",className:"cursor-pointer",children:[e.jsx(A,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"ここにCSVファイルをドラッグ＆ドロップ"}),e.jsx("p",{className:"text-gray-500 text-sm my-2",children:"または"}),e.jsx("span",{className:"text-brand-blue font-semibold",children:"ファイルを選択"})]}),w&&e.jsx("p",{className:"text-red-500 mt-4",children:w})]})}),e.jsxs("footer",{className:"flex justify-end items-center p-4 border-t bg-gray-50 rounded-b-lg gap-2",children:[e.jsx("button",{onClick:p,className:"px-4 py-2 text-gray-700 bg-gray-200 hover:bg-gray-300 rounded-md transition-colors",children:"キャンセル"}),e.jsx("button",{onClick:R,disabled:!y||F||Object.values(g).every(a=>a==="none"),className:"px-4 py-2 bg-brand-blue text-white rounded-md hover:bg-blue-800 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed",children:"インポート実行"})]})]})})};export{z as default};
