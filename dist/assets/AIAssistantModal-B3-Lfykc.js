import{r as l,j as e,g as v,C as L,G as M,t as _,e as $,f as G,A as I}from"./index-DWy39khm.js";import{g as C}from"./aiService-XlMwY8J1.js";const k=()=>e.jsxs("div",{className:"flex justify-center items-center p-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-brand-blue"}),e.jsx("p",{className:"ml-3 text-gray-600",children:"AIが思考中です..."})]}),R=({isOpen:A,onClose:S,person:T,activities:y,provider:i,onApplyGeneratedMemo:D})=>{const[d,m]=l.useState("menu"),[u,o]=l.useState(!1),[r,a]=l.useState(""),[h,j]=l.useState(""),[x,t]=l.useState(""),[f,b]=l.useState(!1),E=[...y].sort((s,g)=>new Date(s.date).getTime()-new Date(g.date).getTime()),N=()=>{m("menu"),o(!1),a(""),j(""),t(""),b(!1),S()},w=()=>i===I.GEMINI?localStorage.getItem("gemini_api_key"):i===I.OPENAI?localStorage.getItem("openai_api_key"):null,K=async()=>{if(y.length===0){a("要約対象の活動履歴がありません。");return}const s=w();if(!s){t("APIキーが設定されていません。設定画面でキーを入力してください。");return}o(!0),t(""),a("");const p=`以下の活動履歴を、対象者の状況が簡潔にわかるように100字以内で要約してください。箇条書きは使わず、自然な文章でまとめてください。

活動履歴:
${E.map(n=>`- ${new Date(n.date).toLocaleDateString("ja-JP")}: ${n.content}`).join(`
`)}`,c="あなたは福祉委員の業務をサポートする優秀なアシスタントです。";try{const n=await C(i,p,s,c);a(n)}catch(n){t(n.message||"AIとの通信中にエラーが発生しました。")}finally{o(!1)}},P=async()=>{if(!h.trim()){t("メモの元になるキーワードを入力してください。");return}const s=w();if(!s){t("APIキーが設定されていません。設定画面でキーを入力してください。");return}o(!0),t(""),a("");const g=`以下のキーワードを元に、民生委員としての丁寧で簡潔な活動記録（活動メモ）を作成してください。

キーワード:
${h}`,p="あなたは福祉委員の業務をサポートする優秀なアシスタントです。ですます調で、客観的な事実を記録するような文体で書いてください。";try{const c=await C(i,g,s,p);a(c)}catch(c){t(c.message||"AIとの通信中にエラーが発生しました。")}finally{o(!1)}},z=()=>{navigator.clipboard.writeText(r).then(()=>{b(!0),setTimeout(()=>b(!1),2e3)})};return A?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-[55] flex justify-center items-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col",children:[e.jsxs("header",{className:"flex justify-between items-center p-4 border-b",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(v,{className:"h-7 w-7 text-theme-purple"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"AIアシスタント"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["対象者: ",T.name]})]})]}),e.jsx("button",{onClick:N,className:"text-gray-500 hover:text-gray-800",children:e.jsx(L,{className:"h-6 w-6"})})]}),e.jsxs("main",{className:"p-6 overflow-y-auto flex-grow",children:[d==="menu"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:()=>{m("summarize"),K()},className:"p-6 border rounded-lg hover:bg-gray-50 text-center transition-colors",children:[e.jsx(M,{className:"h-10 w-10 mx-auto text-brand-blue mb-2"}),e.jsx("h3",{className:"font-semibold text-gray-800",children:"活動履歴を要約"}),e.jsx("p",{className:"text-sm text-gray-600",children:"これまでの活動を短くまとめます。"})]}),e.jsxs("button",{onClick:()=>m("generate"),className:"p-6 border rounded-lg hover:bg-gray-50 text-center transition-colors",children:[e.jsx(_,{className:"h-10 w-10 mx-auto text-theme-green mb-2"}),e.jsx("h3",{className:"font-semibold text-gray-800",children:"活動メモを作成"}),e.jsx("p",{className:"text-sm text-gray-600",children:"キーワードから活動メモを生成します。"})]})]}),d==="summarize"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-4",children:"活動履歴の要約"}),u&&e.jsx(k,{}),x&&e.jsx("p",{className:"text-red-500 bg-red-50 p-3 rounded-md",children:x}),r&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"p-4 bg-gray-50 rounded-md whitespace-pre-wrap",children:r}),e.jsxs("button",{onClick:z,className:"flex items-center gap-2 px-3 py-1.5 text-sm bg-blue-100 text-brand-blue rounded-md hover:bg-blue-200",children:[f?e.jsx($,{className:"h-4 w-4 text-green-600"}):e.jsx(G,{className:"h-4 w-4"}),e.jsx("span",{children:f?"コピーしました":"結果をコピー"})]})]})]}),d==="generate"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"活動メモの作成"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"keywords",className:"block text-sm font-medium text-gray-600 mb-1",children:"キーワード"}),e.jsx("textarea",{id:"keywords",value:h,onChange:s=>j(s.target.value),placeholder:"例：電話で安否確認、元気そうだった",rows:3,className:"w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-blue bg-white text-gray-900"}),e.jsxs("button",{onClick:P,disabled:u,className:"mt-2 flex items-center gap-2 px-4 py-2 bg-brand-blue text-white rounded-md hover:bg-blue-800 disabled:bg-gray-400",children:[e.jsx(v,{className:"h-5 w-5"}),e.jsx("span",{children:"生成する"})]})]}),u&&e.jsx(k,{}),x&&e.jsx("p",{className:"text-red-500 bg-red-50 p-3 rounded-md",children:x}),r&&e.jsxs("div",{className:"border-t pt-4 space-y-2",children:[e.jsx("label",{htmlFor:"generated-memo",className:"block text-sm font-medium text-gray-600",children:"生成されたメモ（編集可）"}),e.jsx("textarea",{id:"generated-memo",value:r,onChange:s=>a(s.target.value),rows:5,className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50 focus:outline-none focus:ring-2 focus:ring-brand-blue"}),e.jsx("button",{onClick:()=>D(r),className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:"この内容で活動履歴に追加"})]})]})]}),e.jsxs("footer",{className:"flex justify-between items-center p-4 border-t bg-gray-50 rounded-b-lg",children:[d!=="menu"?e.jsx("button",{onClick:()=>m("menu"),className:"px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-md",children:"戻る"}):e.jsx("div",{}),e.jsx("button",{onClick:N,className:"px-4 py-2 text-gray-700 bg-gray-200 hover:bg-gray-300 rounded-md",children:"閉じる"})]})]})}):null};export{R as default};
